<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Bobix Corporation - Главная</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Russo+One&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="grid-bg"></div>
    
    <header>
    <div class="header-container">
        <div class="logo">
            <i class="fas fa-crown logo-icon"></i>
            <div class="logo-text">BOBIX <span>CORPORATION</span></div>
        </div>
        <nav>
            <ul>
                <li><a href="#home" class="active"><i class="fas fa-home"></i> Главная</a></li>
                <li><a href="#thresholds"><i class="fas fa-layer-group"></i> Пороги</a></li>
                <li><a href="#top"><i class="fas fa-trophy"></i> Топ игроков</a></li>
                <li><a href="#news"><i class="fas fa-newspaper"></i> Новости</a></li>
                <li><a href="#about"><i class="fas fa-info-circle"></i> О нас</a></li>
                <!-- ТОЛЬКО ОДНА кнопка входа -->
                <li id="loginBtnContainer">
                    <button id="loginBtn" class="nav-login-btn">
                        <i class="fas fa-sign-in-alt"></i> Log In
                    </button>
                </li>
            </ul>
        </nav>
    </div>
</header>

    <main class="container">
        <section class="hero fade-in" id="home">
            <h1>ЭЛИТА SHINDO LIFE</h1>
            <p>Bobix Corporation объединяет сильнейших игроков Shindo Life, каждый из которых выбрал свой уникальный путь развития через систему порогов.</p>
            <button id="mainLoginBtn" class="btn">ВОЙТИ В СИСТЕМУ</button>
        </section>

        <section class="thresholds-info fade-in" id="thresholds">
            <h2>СИСТЕМА ПОРОГОВ</h2>
            <p><strong>Порог</strong> - это путь, который выбрал игрок и развивает свой порог, чтобы стать сильным.</p>
            
            <div class="threshold-types">
                <div class="threshold-card">
                    <div class="threshold-number">1</div>
                    <h3>Порог Силы</h3>
                    <p>Нанесение увечий, скорость нанесения увечий и урона.</p>
                </div>
                
                <div class="threshold-card">
                    <div class="threshold-number">2</div>
                    <h3>Порог Меткости</h3>
                    <p>Путь и развитие меткости (Aim). Мастера этого порога поражают цели с невероятной точностью.</p>
                </div>
                
                <div class="threshold-card">
                    <div class="threshold-number">3</div>
                    <h3>Порог Защиты</h3>
                    <p>Умение блокировать и парировать атаки противника.</p>
                </div>
                
                <div class="threshold-card">
                    <div class="threshold-number">4</div>
                    <h3>Порог Скорости</h3>
                    <p>Управление темпом игры и быстрое использование комбо.</p>
                </div>
            </div>
        </section>

        <section class="top-players-section" id="top">
            <h2 class="section-title fade-in">ТОП ИГРОКОВ BOBIX CORPORATION</h2>
            <div class="players-container">
                <div class="player-card fade-in">
                    <div class="player-rank">TOP 1</div>
                    <div class="player-info">
                        <div class="player-avatar"><i class="fas fa-fire"></i></div>
                        <div><h3 class="player-name">Sayrex</h3></div>
                    </div>
                    <p class="player-description">Абсолютный чемпион с максимальным развитием порогов силы и меткости.</p>
                </div>
                
                <div class="player-card fade-in">
                    <div class="player-rank">TOP 2</div>
                    <div class="player-info">
                        <div class="player-avatar"><i class="fas fa-shield-alt"></i></div>
                        <div><h3 class="player-name">Marfet</h3></div>
                    </div>
                    <p class="player-description">Непробиваемый защитник с легендарными оборонительными способностями.</p>
                </div>
            </div>
        </section>
        <!-- Секция News -->
<section id="news" class="content-section">
    <div class="section-header">
        <h2><i class="fas fa-newspaper"></i> Новости Bobix Corporation</h2>
        <p>Актуальные новости и объявления клана</p>
    </div>
    
    <div class="news-content">
        <!-- Кнопка добавления поста (только для админов/владельцев) -->
        <div class="admin-controls-header admin-only" style="display: none;">
            <div>
                <h3><i class="fas fa-bullhorn"></i> Управление новостями</h3>
                <p>Публикуйте новости и объявления для всего клана</p>
            </div>
            <div class="admin-actions">
                <button class="admin-btn primary" onclick="openCreatePostModal()">
                    <i class="fas fa-plus-circle"></i> Опубликовать пост
                </button>
                <button class="admin-btn" onclick="loadNewsPosts()">
                    <i class="fas fa-sync-alt"></i> Обновить
                </button>
            </div>
        </div>
        
        <!-- Список новостей -->
        <div class="news-posts" id="newsPosts">
            <div class="loading">
                <i class="fas fa-spinner fa-spin"></i>
                <p>Загрузка новостей...</p>
            </div>
        </div>
    </div>
    <!-- Модальное окно создания поста -->
<div id="createPostModal" class="modal">
    <div class="modal-content" style="max-width: 700px;">
        <span class="close-modal" onclick="closeCreatePostModal()">&times;</span>
        <h2><i class="fas fa-edit"></i> Создать новый пост</h2>
        <form id="createPostForm">
            <div class="form-group">
                <label for="postTitle"><i class="fas fa-heading"></i> Заголовок</label>
                <input type="text" id="postTitle" class="edit-input" placeholder="Введите заголовок поста" required>
            </div>
            
            <div class="form-group">
                <label for="postContent"><i class="fas fa-file-alt"></i> Содержание</label>
                <textarea id="postContent" class="edit-input" placeholder="Введите содержание поста" rows="8" required></textarea>
            </div>
            
            <div class="form-group">
                <label for="postImage"><i class="fas fa-image"></i> Изображение (опционально)</label>
                <div class="image-upload-container">
                    <input type="file" id="postImage" class="edit-input" accept="image/*" onchange="previewImage(event)">
                    <div class="image-preview" id="imagePreview">
                        <p>Предпросмотр изображения появится здесь</p>
                    </div>
                </div>
            </div>
            
            <div class="form-group">
                <label class="checkbox-label">
                    <input type="checkbox" id="postPublished" checked>
                    <span>Опубликовать сразу</span>
                </label>
            </div>
            
            <div class="admin-controls">
                <button type="submit" class="admin-btn primary">
                    <i class="fas fa-paper-plane"></i> Опубликовать
                </button>
                <button type="button" class="admin-btn" onclick="saveAsDraft()">
                    <i class="fas fa-save"></i> Сохранить черновик
                </button>
                <button type="button" class="admin-btn" onclick="closeCreatePostModal()">
                    <i class="fas fa-times"></i> Отмена
                </button>
            </div>
        </form>
    </div>
</div>
</section>
    </main>

    <!-- Модальное окно авторизации -->
    <div id="authModal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2 id="authTitle">Вход в систему</h2>
            <form id="authForm">
                <div class="form-group">
                    <input type="email" id="email" placeholder="Электронная почта" required>
                </div>
                
                <div class="form-group reg-field" style="display:none">
                    <input type="text" id="username" placeholder="Ваш никнейм" required>
                </div>
                
                <div class="form-group">
                    <input type="password" id="password" placeholder="Пароль" required>
                </div>
                
                <div class="form-group reg-field" style="display:none">
                    <input type="password" id="confirmPass" placeholder="Повторите пароль" required>
                </div>
                
                <div id="authError" class="error-message" style="display:none;"></div>
                
                <button type="submit" id="submitBtn" class="btn-yellow">Войти</button>
                
                <div class="auth-footer">
                    <span id="toggleAuth">Нет аккаунта? Зарегистрироваться</span>
                    <a href="#" class="forgot-password">Забыли пароль?</a>
                </div>
            </form>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="db.js"></script>
    <script src="auth.js"></script>
    <script>
        // Инициализация событий для кнопок входа
        document.addEventListener('DOMContentLoaded', function() {
            const loginBtn = document.getElementById('loginBtn');
            const mainLoginBtn = document.getElementById('mainLoginBtn');
            const closeModal = document.querySelector('.close-modal');
            const modal = document.getElementById('authModal');
            
            // Функция открытия модального окна
            function openAuthModal() {
                modal.style.display = 'flex';
                document.body.style.overflow = 'hidden'; // Блокируем скролл
            }
            
            // Функция закрытия модального окна
            function closeAuthModal() {
                modal.style.display = 'none';
                document.body.style.overflow = 'auto'; // Возвращаем скролл
            }
            
            // Обработчики событий
            if (loginBtn) loginBtn.addEventListener('click', openAuthModal);
            if (mainLoginBtn) mainLoginBtn.addEventListener('click', openAuthModal);
            if (closeModal) closeModal.addEventListener('click', closeAuthModal);
            
            // Закрытие модального окна при клике вне его
            window.addEventListener('click', function(event) {
                if (event.target === modal) {
                    closeAuthModal();
                }
            });
            
            // Закрытие модального окна по клавише Escape
            document.addEventListener('keydown', function(event) {
                if (event.key === 'Escape' && modal.style.display === 'flex') {
                    closeAuthModal();
                }
            });
            
            // Проверка текущей сессии пользователя
            async function checkCurrentSession() {
                try {
                    const { data: { user } } = await _supabase.auth.getUser();
                    if (user) {
                        // Если пользователь уже авторизован, скрываем кнопку входа
                        if (loginBtn) loginBtn.style.display = 'none';
                        if (mainLoginBtn) {
                            mainLoginBtn.innerHTML = '<i class="fas fa-tachometer-alt"></i> ПЕРЕЙТИ В ПАНЕЛЬ УПРАВЛЕНИЯ';
                            mainLoginBtn.onclick = () => window.location.href = 'management.html';
                        }
                    }
                } catch (error) {
                    console.error('Ошибка при проверке сессии:', error);
                }
            }
            
            checkCurrentSession();
        });
    </script>
</body>
</html>
