<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Bobix Corporation - Главная</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Russo+One&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="grid-bg"></div>
    
    <header>
    <div class="header-container">
        <div class="logo">
            <i class="fas fa-crown logo-icon"></i>
            <div class="logo-text">BOBIX <span>CORPORATION</span></div>
        </div>
        <nav>
            <ul>
                <li><a href="#home" class="active"><i class="fas fa-home"></i> Главная</a></li>
                <li><a href="#thresholds"><i class="fas fa-layer-group"></i> Пороги</a></li>
                <li><a href="#top"><i class="fas fa-trophy"></i> Топ игроков</a></li>
                <li><a href="#news"><i class="fas fa-newspaper"></i> Новости</a></li>
                <li><a href="#about"><i class="fas fa-info-circle"></i> О нас</a></li>
                <!-- ТОЛЬКО ОДНА кнопка входа -->
                <li id="loginBtnContainer">
                    <button id="loginBtn" class="nav-login-btn">
                        <i class="fas fa-sign-in-alt"></i> Log In
                    </button>
                </li>
            </ul>
        </nav>
    </div>
</header>

    <main class="container">
        <section class="hero fade-in" id="home">
            <h1>ЭЛИТА SHINDO LIFE</h1>
            <p>Bobix Corporation объединяет сильнейших игроков Shindo Life, каждый из которых выбрал свой уникальный путь развития через систему порогов.</p>
            <button id="mainLoginBtn" class="btn">ВОЙТИ В СИСТЕМУ</button>
        </section>

        <section class="thresholds-info fade-in" id="thresholds">
            <h2>СИСТЕМА ПОРОГОВ</h2>
            <p><strong>Порог</strong> - это путь, который выбрал игрок и развивает свой порог, чтобы стать сильным.</p>
            
            <div class="threshold-types">
                <div class="threshold-card">
                    <div class="threshold-number">1</div>
                    <h3>Порог Силы</h3>
                    <p>Нанесение увечий, скорость нанесения увечий и урона.</p>
                </div>
                
                <div class="threshold-card">
                    <div class="threshold-number">2</div>
                    <h3>Порог Меткости</h3>
                    <p>Путь и развитие меткости (Aim). Мастера этого порога поражают цели с невероятной точностью.</p>
                </div>
                
                <div class="threshold-card">
                    <div class="threshold-number">3</div>
                    <h3>Порог Защиты</h3>
                    <p>Умение блокировать и парировать атаки противника.</p>
                </div>
                
                <div class="threshold-card">
                    <div class="threshold-number">4</div>
                    <h3>Порог Скорости</h3>
                    <p>Управление темпом игры и быстрое использование комбо.</p>
                </div>
            </div>
        </section>

        <section class="top-players-section" id="top">
            <h2 class="section-title fade-in">ТОП ИГРОКОВ BOBIX CORPORATION</h2>
            <div class="players-container">
                <div class="player-card fade-in">
                    <div class="player-rank">TOP 1</div>
                    <div class="player-info">
                        <div class="player-avatar"><i class="fas fa-fire"></i></div>
                        <div><h3 class="player-name">Sayrex</h3></div>
                    </div>
                    <p class="player-description">Абсолютный чемпион с максимальным развитием порогов силы и меткости.</p>
                </div>
                
                <div class="player-card fade-in">
                    <div class="player-rank">TOP 2</div>
                    <div class="player-info">
                        <div class="player-avatar"><i class="fas fa-shield-alt"></i></div>
                        <div><h3 class="player-name">Marfet</h3></div>
                    </div>
                    <p class="player-description">Непробиваемый защитник с легендарными оборонительными способностями.</p>
                </div>
            </div>
        </section>
        <!-- Секция News -->
<!-- Секция Новости -->
<section class="thresholds-info fade-in" id="news">
    <h2><i class="fas fa-newspaper"></i> НОВОСТИ КЛАНА</h2>
    <p>Последние обновления и объявления Bobix Corporation</p>
    
    <div class="news-preview" id="newsPreview">
        <div class="loading">
            <i class="fas fa-spinner fa-spin"></i>
            <p>Загрузка новостей...</p>
        </div>
    </div>
    
    <div style="text-align: center; margin-top: 2rem;">
        <a href="#login" class="btn" onclick="openAuthModal()">
            <i class="fas fa-sign-in-alt"></i> ВОЙТИ ДЛЯ ПРОСМОТРА ВСЕХ НОВОСТЕЙ
        </a>
    </div>
</section>
        
    <!-- Модальное окно создания поста -->
<div id="createPostModal" class="modal">
    <div class="modal-content" style="max-width: 700px;">
        <span class="close-modal" onclick="closeCreatePostModal()">&times;</span>
        <h2><i class="fas fa-edit"></i> Создать новый пост</h2>
        <form id="createPostForm">
            <div class="form-group">
                <label for="postTitle"><i class="fas fa-heading"></i> Заголовок</label>
                <input type="text" id="postTitle" class="edit-input" placeholder="Введите заголовок поста" required>
            </div>
            
            <div class="form-group">
                <label for="postContent"><i class="fas fa-file-alt"></i> Содержание</label>
                <textarea id="postContent" class="edit-input" placeholder="Введите содержание поста" rows="8" required></textarea>
            </div>
            
            <div class="form-group">
                <label for="postImage"><i class="fas fa-image"></i> Изображение (опционально)</label>
                <div class="image-upload-container">
                    <input type="file" id="postImage" class="edit-input" accept="image/*" onchange="previewImage(event)">
                    <div class="image-preview" id="imagePreview">
                        <p>Предпросмотр изображения появится здесь</p>
                    </div>
                </div>
            </div>
            
            <div class="form-group">
                <label class="checkbox-label">
                    <input type="checkbox" id="postPublished" checked>
                    <span>Опубликовать сразу</span>
                </label>
            </div>
            
            <div class="admin-controls">
                <button type="submit" class="admin-btn primary">
                    <i class="fas fa-paper-plane"></i> Опубликовать
                </button>
                <button type="button" class="admin-btn" onclick="saveAsDraft()">
                    <i class="fas fa-save"></i> Сохранить черновик
                </button>
                <button type="button" class="admin-btn" onclick="closeCreatePostModal()">
                    <i class="fas fa-times"></i> Отмена
                </button>
            </div>
        </form>
    </div>
</div>
</section>
    </main>

    <!-- Модальное окно авторизации -->
    <div id="authModal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2 id="authTitle">Вход в систему</h2>
            <form id="authForm">
                <div class="form-group">
                    <input type="email" id="email" placeholder="Электронная почта" required>
                </div>
                
                <div class="form-group reg-field" style="display:none">
                    <input type="text" id="username" placeholder="Ваш никнейм" required>
                </div>
                
                <div class="form-group">
                    <input type="password" id="password" placeholder="Пароль" required>
                </div>
                
                <div class="form-group reg-field" style="display:none">
                    <input type="password" id="confirmPass" placeholder="Повторите пароль" required>
                </div>
                
                <div id="authError" class="error-message" style="display:none;"></div>
                
                <button type="submit" id="submitBtn" class="btn-yellow">Войти</button>
                
                <div class="auth-footer">
                    <span id="toggleAuth">Нет аккаунта? Зарегистрироваться</span>
                    <a href="#" class="forgot-password">Забыли пароль?</a>
                </div>
            </form>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="db.js"></script>
    <script src="auth.js"></script>
    <script>
        // Инициализация событий для кнопок входа
        document.addEventListener('DOMContentLoaded', function() {
            const loginBtn = document.getElementById('loginBtn');
            const mainLoginBtn = document.getElementById('mainLoginBtn');
            const closeModal = document.querySelector('.close-modal');
            const modal = document.getElementById('authModal');
            
            // Функция открытия модального окна
            function openAuthModal() {
                modal.style.display = 'flex';
                document.body.style.overflow = 'hidden'; // Блокируем скролл
            }
            
            // Функция закрытия модального окна
            function closeAuthModal() {
                modal.style.display = 'none';
                document.body.style.overflow = 'auto'; // Возвращаем скролл
            }
            
            // Обработчики событий
            if (loginBtn) loginBtn.addEventListener('click', openAuthModal);
            if (mainLoginBtn) mainLoginBtn.addEventListener('click', openAuthModal);
            if (closeModal) closeModal.addEventListener('click', closeAuthModal);
            
            // Закрытие модального окна при клике вне его
            window.addEventListener('click', function(event) {
                if (event.target === modal) {
                    closeAuthModal();
                }
            });
            
            // Закрытие модального окна по клавише Escape
            document.addEventListener('keydown', function(event) {
                if (event.key === 'Escape' && modal.style.display === 'flex') {
                    closeAuthModal();
                }
            });
            
            // Проверка текущей сессии пользователя
            async function checkCurrentSession() {
                try {
                    const { data: { user } } = await _supabase.auth.getUser();
                    if (user) {
                        // Если пользователь уже авторизован, скрываем кнопку входа
                        if (loginBtn) loginBtn.style.display = 'none';
                        if (mainLoginBtn) {
                            mainLoginBtn.innerHTML = '<i class="fas fa-tachometer-alt"></i> ПЕРЕЙТИ В ПАНЕЛЬ УПРАВЛЕНИЯ';
                            mainLoginBtn.onclick = () => window.location.href = 'management.html';
                        }
                    }
                } catch (error) {
                    console.error('Ошибка при проверке сессии:', error);
                }
            }
            
            checkCurrentSession();
        });
        async function loadLatestNews() {
    try {
        const newsPreview = document.getElementById('newsPreview');
        if (!newsPreview) return;
        
        // Показываем только 3 последние новости
        const { data: posts, error } = await _supabase
            .from('news_posts')
            .select('*')
            .eq('is_published', true)
            .order('created_at', { ascending: false })
            .limit(3);
        
        if (error) {
            console.error('Ошибка загрузки новостей:', error);
            newsPreview.innerHTML = `
                <div class="threshold-card">
                    <p>Новости временно недоступны</p>
                </div>
            `;
            return;
        }
        
        if (!posts || posts.length === 0) {
            newsPreview.innerHTML = `
                <div class="threshold-card">
                    <h3><i class="fas fa-newspaper"></i> Новостей пока нет</h3>
                    <p>Следите за обновлениями!</p>
                </div>
            `;
            return;
        }
        
        let html = '';
        
        posts.forEach(post => {
            // Обрезаем текст для предпросмотра
            const previewText = post.content.length > 150 
                ? post.content.substring(0, 150) + '...' 
                : post.content;
                
            // Форматируем дату
            const postDate = new Date(post.created_at);
            const formattedDate = postDate.toLocaleDateString('ru-RU', {
                day: 'numeric',
                month: 'long',
                year: 'numeric'
            });
            
            html += `
                <div class="threshold-card news-preview-card">
                    <div class="news-date">
                        <i class="fas fa-calendar"></i> ${formattedDate}
                    </div>
                    <h3>${escapeHtml(post.title)}</h3>
                    <p>${escapeHtml(previewText)}</p>
                    <div class="news-author">
                        <i class="fas fa-user"></i> ${escapeHtml(post.author_name || 'Администратор')}
                    </div>
                </div>
            `;
        });
        
        newsPreview.innerHTML = html;
        
    } catch (error) {
        console.error('Неожиданная ошибка:', error);
    }
}

// Функция экранирования HTML
function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}

// Загружаем новости при загрузке страницы
document.addEventListener('DOMContentLoaded', function() {
    loadLatestNews();
});
    </script>
</body>
</html>
